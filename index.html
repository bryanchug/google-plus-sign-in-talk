<!DOCTYPE html>

<!--
  Google HTML5 slide template

  Authors: Luke Mahé (code)
           Marcin Wichary (code and design)
           
           Dominic Mazzoni (browser compatibility)
           Charles Chen (ChromeVox support)

  URL: http://code.google.com/p/html5slides/
-->

<html>
<head>
    <title>Intro to Google+ Sign-In</title>

    <meta charset='utf-8'>
    <script
            src='https://html5slides.googlecode.com/svn/trunk/slides.js'></script>
</head>

<style>
        /* Your individual styles here, or just use inline styles if that’s
     what you want. */


</style>

<body style='display: none'>

<section class='slides layout-regular template-default'>

    <!-- Your slides (<article>s) go here. Delete or comment out the
  slides below. -->


    <article class='biglogo'>
    </article>

    <article>
        <h1>
            Intro to Google+ Sign-In
        </h1>

        <p>
            Bryan Chug
            <br>
            September 17, 2013
        </p>
    </article>

    <article>
        <iframe width="560" height="315" src="//www.youtube.com/embed/VSCyyHMDJ94" frameborder="0"
                allowfullscreen></iframe>
    </article>

    <article>
        <h3 style="font-size: 30px">
            This session aims to bring to light...
        </h3>
        <ul class="build" style="font-size: 60px">
            <li class="blue">What is it?</li>
            <li class="red">How does it help?</li>
            <li style="color: orange">How to get started?</li>
        </ul>
    </article>

    <article>
        <h3>
            What is it?
        </h3>

        <p>
            Third-party Authentication Provider
        </p>
        <ul class="build">
            <li>
                Google+<br/>
                <img style="max-height: 50px"
                     src="https://developers.google.com/+/images/branding/sign-in-buttons/Red-signin_Medium_base_44dp.png"/>
            </li>
            <li>
                Facebook<br/>
                <img style="max-height: 50px"
                     src="https://fbcdn-dragon-a.akamaihd.net/hphotos-ak-prn1/851565_207329966095351_137697998_n.png"/>
            </li>
            <li>
                Twitter<br/>
                <img style="max-height: 50px"
                     src="https://dev.twitter.com/sites/default/files/images_documentation/sign-in-with-twitter-gray.png"/>
            </li>
        </ul>
    </article>

    <article>
        <h3>
            What is it?
        </h3>

        <p>
            Also acts as the gateway to <a target="_blank" href="https://developers.google.com/apis-explorer">Google
            APIs</a>
        </p>
        <ul class="build">
            <li>Allows users to login or register effortlessly</li>
            <li>Allows the app to access user data from Google+ and other Google Services</li>
            <li>Allows the app to perform actions on Google+ on behalf of the user</li>
        </ul>
        <div class="source">
            https://developers.google.com/apis-explorer
        </div>
    </article>

    <article>
        <h3>
            Benefits
        </h3>
        <ul class="build">
            <li>Makes it easier to develop apps</li>
            <li>
                Increases conversion
                <ul class="build" style="margin-top: 10px; color: orangered">
                    <li>Frictionless registration</li>
                    <li>One less password needed to remember</li>
                    <li>Trusted & secured</li>
                </ul>
            </li>
            <li>Provides ability to integrate with Google+ to customize the user experience</li>
            <li>Allows your apps to tap into the Google+ social network</li>
        </ul>
    </article>

    <article class="fill">
        <h1 style="color: #000">Let's get started!</h1>
        <p>
            <img style="opacity: 0.38; width: 100%" src="http://static5.businessinsider.com/image/511118eb69bedd9949000002/google-us-government-spying-has-risen-122-percent-since-2009.jpg"/>
        </p>
    </article>

    <article>
        <h3>Sample Project</h3>
        <h4>You can see follow along by viewing the source of the sample project here - <a target="_blank" href="http://goo.gl/01pGzD">http://goo.gl/01pGzD</a></h4>

        <h3>Steps</h3>
        <ul class="build">
            <li>Get API Access</li>
            <li>Try out the <strong class="red">client-side</strong> flow of Google+ Sign-In</li>
            <li>Try out the <strong class="green">server-side</strong> flow of Google+ Sign-In</li>
        </ul>
    </article>

    <article>
        <h3>Get API Access</h3>
        <p style="font-size: 24px">
            Go to Google API Console -
            <a target="_blank" href="https://code.google.com/apis/console/">https://code.google.com/apis/console/</a>
        </p>
        <p>
            <h4>Create a webapp client ID</h4>
            <img src="https://developers.google.com/maps/documentation/javascript/images/api_console_key.jpg"/>
        </p>
    </article>

    <article>
        <h3>Get API Access</h3>
        <p>
            <h4>Turn on Google+ API Services</h4>
            <img src="http://kinlane-productions.s3.amazonaws.com/google/Google-APIs-Console-1.png"/>
        </p>
        <div class="source">
            http://apievangelist.com/2011/05/21/google-apis-console/
        </div>
    </article>

    <article>
        <h3>Try out the client-side flow</h3>
        <p>
            Include the Google+ JavaScript on your page
            <section>
                <pre>&lt;!-- Place this asynchronous JavaScript just before your &lt;/body&gt; tag --&gt;
&lt;script type="text/javascript"&gt;
(function() {
var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
po.src = 'https://apis.google.com/js/client:plusone.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
&lt;/script&gt;</pre>
            </section>
        </p>
        <div class="source">
            https://developers.google.com/+/web/signin/#step_2_include_the_google_script_on_your_page
        </div>
    </article>

    <article>
        <h3>Try out the client-side flow</h3>
        <p>
            Add the sign-in button to your page
            <section>
                <pre>&lt;span id="signinButton"&gt;
    &lt;span
        class="g-signin"
        data-callback="signinCallback"
        data-clientid="CLIENT_ID"
        data-cookiepolicy="single_host_origin"
        data-requestvisibleactions="http://schemas.google.com/AddActivity"
        data-scope="https://www.googleapis.com/auth/plus.login"&gt;
    &lt;/span&gt;
&lt;/span&gt;</pre>
            </section>
        </p>
        <div class="source">
            https://developers.google.com/+/web/signin/#step_3_adding_a_sign-in_button_to_your_page
        </div>
    </article>

    <article>
        <h3>Try out the client-side flow</h3>
        <p>
            Handling the sign-in
        </p>
        <section>
            <pre style="font-size: 15px; line-height: 1.5">&lt;script type="text/javascript"&gt;
function signinCallback(authResult){
    if( authResult['access_token'] ){
        gapi.client.load('plus', 'v1', function(){
            var request = gapi.client.plus.people.get({ 'userId': 'me' });
            request.execute(function(resp) {
                console.log(resp);
                //Using jQuery
                var tbody = $('#gplus-profile tbody');
                tbody.append("&lt;tr&gt;&lt;td&gt;Given Name&lt;/td&gt;&lt;td&gt;"+resp.name.givenName+"&lt;/td&gt;");
                tbody.append("&lt;tr&gt;&lt;td&gt;Family Name&lt;/td&gt;&lt;td&gt;"+resp.name.familyName+"&lt;/td&gt;");
                tbody.append("&lt;tr&gt;&lt;td&gt;Photo&lt;/td&gt;&lt;td&gt;&lt;img src='"+resp.image.url+"'/&gt;&lt;/td&gt;");
            });
        });
    }
}
&lt;/script&gt;</pre>
        </section>
        <div class="source green">
            https://github.com/bryanchug/grails-google-plus-sign-in-app/commit/1383573a024b145e7b731b7cc4d9c4e990caa41c
        </div>
    </article>

    <article>
        <h3>Try out the client-side flow - <a href="https://developers.google.com/apis-explorer">APIs Explorer</a></h3>
        https://developers.google.com/apis-explorer
        <p>
            <img style="max-height: 450px" src="http://kinlane-productions.s3.amazonaws.com/google/Google-API-Explorer-v2.png"/>
        </p>
        <div class="source">
            http://apievangelist.com/2012/05/23/google-updates-the-api-explorer/
        </div>
    </article>

    <article class="fill">
        <h1 style="color: #fff">Let's now try the server-side flow!</h1>
        <p>
            <img style="opacity: 1.0; width: 100%" src="http://www.datacenterknowledge.com/wp-content/uploads/2011/04/prineville-servers-1000.jpg"/>
        </p>
    </article>

    <article>
        <h3>Try out the server-side flow</h3>
        <h4>The server-side flow allows full integration, so that a signed-in Google+ user can now be trusted by the server.</h4>
        <p>
            <img src="https://developers.google.com/+/images/server_side_code_flow.png"/>
        </p>
        <div class="source">
            https://developers.google.com/+/web/signin/server-side-flow
        </div>
    </article>

    <article>
        <h3>Try out the server-side flow</h3>

        <h4>We'll use a Grails webapp as the sample server</h4>
        <img src="http://grails.org/doc/latest/img/grails.png"/>

        <h4>We'll go with using Java libraries/dependencies from the Maven repository</h4>
        <section>
            <pre>com.google.api-client:google-api-client:1.16.0-rc
com.google.http-client:google-http-client-jackson2:1.16.0-rc
com.google.apis:google-api-services-oauth2:v2-rev48-1.16.0-rc</pre>
        </section>

        <div class="source">
            http://grails.org/<br/>
            https://github.com/bryanchug/grails-google-plus-sign-in-app
        </div>
    </article>

    <article>
        <h3>Try out the server-side flow - Send the authorization code to the server</h3>
        <section>
            <pre style="font-size: 15px; line-height: 1.5">function signinCallback(authResult) {
    //added authResult['g-oauth-window'] to check sign-in button
    //was explicitly clicked
    if (authResult['access_token'] && authResult['g-oauth-window']) {
        console.log( authResult );
        gapi.client.load('oauth2', 'v2', function() {
            var request = gapi.client.oauth2.userinfo.get();
            request.execute(function(obj){
                $.post('/login/plus', {
                    code: authResult.code,
                    email: obj.email,
                    gPlusId: obj.id
                }, function(data){
                    if( data.status == 'success' ){
                        location.href = data.redirectUri;
                    }
                });
            });
        });
    }
}</pre>
        </section>
        <div class="source">
            https://github.com/bryanchug/grails-google-plus-sign-in-app/commit/f9d5be7e4eb6aa781ba8a0790161089069600a2f
        </div>
    </article>

    <article>
        <h3>Try out the server-side flow - Send the authorization code to the server</h3>
        <section>
            <pre style="font-size: 16px; line-height: 1.5">function signinCallback(authResult) {
    //added authResult['g-oauth-window'] to check sign-in button
    //was explicitly clicked
    if (authResult['access_token'] && authResult['g-oauth-window']) {
        console.log( authResult );
        gapi.client.load('oauth2', 'v2', function() {
            var request = gapi.client.oauth2.userinfo.get();
            request.execute(function(obj){
                $.post('/login/plus', {
                    code: authResult.code,
                    email: obj.email,
                    gPlusId: obj.id
                }, function(data){
                    if( data.status == 'success' ){
                        location.href = data.redirectUri;
                    }
                });
            });
        });
    }
}</pre>
        </section>
    </article>

    <article>
        <h3 style="font-size: 22px">Try out the server-side flow - Confirm code & authenticate user to your app</h3>
        <section>
            <pre style="font-size: 14px; line-height: 1.5">def plus = {

    String gPlusId = params.gPlusId
    String code = params.code
    String email = params.email

    // Upgrade the authorization code into an access and refresh token.
    GoogleTokenResponse tokenResponse =
        new GoogleAuthorizationCodeTokenRequest(TRANSPORT, JSON_FACTORY,
                CLIENT_ID, CLIENT_SECRET, code, "postmessage").execute();

    // Create a credential representation of the token data.
    GoogleCredential credential = new GoogleCredential.Builder()
            .setJsonFactory(JSON_FACTORY)
            .setTransport(TRANSPORT)
            .setClientSecrets(CLIENT_ID, CLIENT_SECRET).build()
            .setFromTokenResponse(tokenResponse);

    // Check that the token is valid.
    Oauth2 oauth2 = new Oauth2.Builder(
            TRANSPORT, JSON_FACTORY, credential).build();
    Tokeninfo tokenInfo = oauth2.tokeninfo()
            .setAccessToken(credential.getAccessToken()).execute();

}</pre>
        </section>
        <div class="source">
            https://github.com/bryanchug/grails-google-plus-sign-in-app/commit/f9d5be7e4eb6aa781ba8a0790161089069600a2f
        </div>
    </article>

    <article>
        <h3 style="font-size: 22px">Try out the server-side flow - Confirm code & authenticate user to your app</h3>
        <section>
            <pre style="font-size: 15px; line-height: 1.5">// If there was an error in the token info, abort.
if (tokenInfo.containsKey("error")) {
    response.sendError 401
    return
}
// Make sure the token we got is for the intended user.
if (tokenInfo.getUserId() != gPlusId || tokenInfo.email != email) {
    response.sendError 401
    return
}
// Make sure the token we got is for our app.
if (!tokenInfo.getIssuedTo().equals(CLIENT_ID)) {
    response.sendError 401
    return
}
User user = User.findByUsername(tokenInfo.email)
if (!user) {
    user = new User(username: tokenInfo.email).save()
}
springSecurityService.reauthenticate(user.username)
def jsonResponse = [
    status: 'success',
    redirectUri: SpringSecurityUtils.securityConfig.successHandler.defaultTargetUrl
]
render(jsonResponse as JSON)</pre>
        </section>
    </article>

    <article>
        <h3>Additional Notes</h3>
        <p>
            As a user, to manage app authorization, go to<br/>
            <a style="font-size: 20px" target="_blank" href="https://plus.google.com/apps">https://plus.google.com/apps</a>
        </p>
        <p>
            Allow users to revoke access & disconnect from your app<br/>
            <a style="font-size: 20px" target="_blank" href="https://developers.google.com/+/web/signin/#revoking_access_tokens_and_disconnecting_the_app">
                https://developers.google.com/+/web/signin/#revoking_access_tokens_and_disconnecting_the_app
            </a>
        </p>
        <p>
            Use anti-CSRF tokens<br/>
            <a style="font-size: 20px" target="_blank" href="https://developers.google.com/+/web/signin/server-side-flow#step_2_create_an_anti-request_forgery_state_token">
                https://developers.google.com/+/web/signin/server-side-flow#step_2_create_an_anti-request_forgery_state_token
            </a>
        </p>
    </article>

    <article>
        <h3>Artifacts</h3>
        <ul>
            <li>https://rawgithub.com/bryanchug/google-plus-sign-in-talk/master/index.html</li>
            <li>https://github.com/bryanchug/google-plus-sign-in-talk</li>
            <li>https://github.com/bryanchug/grails-google-plus-sign-in-app</li>
        </ul>
        <h3>References</h3>
        <ul>
            <li>https://developers.google.com/+/web/signin/</li>
            <li>https://developers.google.com/events/io/sessions/331521903</li>
            <li>https://developers.google.com/events/io/sessions/332301066</li>
            <li>https://code.google.com/p/google-api-java-client/</li>
            <li>https://code.google.com/p/google-http-java-client/</li>
            <li>https://code.google.com/p/google-api-java-client/wiki/APIs</li>
        </ul>
    </article>

    <article>
        <h3>
            Thank you!
        </h3>

        <h4>Bryan Carl Chug</h4>
        <ul>
            <li>bryan.chug@gmail.com</li>
            <li>bryan.chug@aestrea.com</li>
            <li>@bryanchug</li>
        </ul>
    </article>

</section>

</body>
</html>
